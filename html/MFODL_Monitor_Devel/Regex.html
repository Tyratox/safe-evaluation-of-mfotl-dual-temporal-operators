<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Regex</title>
</head>


<body>
<div class="head">
<h1>Theory Regex</h1>
</div>

<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Regex
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="../MFOTL_Monitor_Devel/Trace.html">MFOTL_Monitor_Devel.Trace</a>"</span>
    <span class="quoted">"<a href="../../HOL/HOL-Library/Lattice_Syntax.html">HOL-Library.Lattice_Syntax</a>"</span>
    <span class="quoted">"<a href="../../HOL/HOL-Library/Extended_Nat.html">HOL-Library.Extended_Nat</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Regular expressions›</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span>atms<span class="main">:</span> <span class="tfree">'a</span><span class="main">)</span> regex <span class="main">=</span> Skip <span class="quoted">nat</span> <span class="main">|</span> Test <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="main">|</span> Plus <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regex"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regex"</span></span> <span class="main">|</span> Times <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regex"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regex"</span></span>  <span class="main">|</span> Star <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regex"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_atms<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>atms <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Wild</span> <span class="main">=</span> Skip <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> size_regex_estimation<span class="main">[</span><span class="operator">termination_simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> atms <span class="free">r</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">&lt;</span> size_regex <span class="free">f</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> size_regex_estimation'<span class="main">[</span><span class="operator">termination_simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> atms <span class="free">r</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> size_regex <span class="free">f</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">TimesL</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">TimesR</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Times <span class="bound">r</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">fv_regex</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fv_regex</span> <span class="free"><span class="bound"><span class="entity">fv</span></span></span> <span class="main">(</span>Skip <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_regex</span> <span class="free"><span class="bound"><span class="entity">fv</span></span></span> <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">fv</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_regex</span> <span class="free"><span class="bound"><span class="entity">fv</span></span></span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fv_regex</span> <span class="free"><span class="bound"><span class="entity">fv</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∪</span> <span class="free">fv_regex</span> <span class="free"><span class="bound"><span class="entity">fv</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_regex</span> <span class="free"><span class="bound"><span class="entity">fv</span></span></span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fv_regex</span> <span class="free"><span class="bound"><span class="entity">fv</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∪</span> <span class="free">fv_regex</span> <span class="free"><span class="bound"><span class="entity">fv</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_regex</span> <span class="free"><span class="bound"><span class="entity">fv</span></span></span> <span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fv_regex</span> <span class="free"><span class="bound"><span class="entity">fv</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fv_regex_cong<span class="main">[</span><span class="operator">fundef_cong</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">r'</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> atms <span class="free">r</span> <span class="main">⟹</span> <span class="free">fv</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">fv'</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟹</span> fv_regex <span class="free">fv</span> <span class="free">r</span> <span class="main">=</span> fv_regex <span class="free">fv'</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">r'</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_fv_regex<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> atms <span class="free">r</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">fv</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span>fv_regex <span class="free">fv</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fv_regex_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> atms <span class="free">r</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">fv</span> <span class="bound">z</span> <span class="main">⟷</span> <span class="free">g</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">fv'</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> fv_regex <span class="free">fv</span> <span class="free">r</span> <span class="main">⟷</span> <span class="free">g</span> <span class="free">x</span> <span class="main">∈</span> fv_regex <span class="free">fv'</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fv_regex_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"fv_regex <span class="free">fv</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">z</span> <span class="main">∈</span> atms <span class="free">r</span><span class="main">.</span> <span class="free">fv</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">nfv_regex</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nfv_regex</span> <span class="free"><span class="bound"><span class="entity">fv</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> Max <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>Suc <span class="main">`</span> fv_regex <span class="free"><span class="bound"><span class="entity">fv</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> insert_Un<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="free">x</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">x</span> <span class="free">A</span> <span class="main">∪</span> insert <span class="free">x</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nfv_regex_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> atms <span class="free">r</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">fv</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> atms <span class="free">s</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">fv</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"nfv_regex <span class="free">fv</span> <span class="main">(</span>Skip <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"nfv_regex <span class="free">fv</span> <span class="main">(</span>Test <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> Max <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>Suc <span class="main">`</span> <span class="free">fv</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"nfv_regex <span class="free">fv</span> <span class="main">(</span>Plus <span class="free">r</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>nfv_regex <span class="free">fv</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span>nfv_regex <span class="free">fv</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"nfv_regex <span class="free">fv</span> <span class="main">(</span>Times <span class="free">r</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>nfv_regex <span class="free">fv</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span>nfv_regex <span class="free">fv</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"nfv_regex <span class="free">fv</span> <span class="main">(</span>Star <span class="free">r</span><span class="main">)</span> <span class="main">=</span> nfv_regex <span class="free">fv</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nfv_regex_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_Un Max_Un insert_Un <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_right Un_insert_left<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">min_regex_default</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> atms <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="keyword1">else</span> Min <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">z</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">`</span> atms <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">match</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> regex <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">match</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="main">(</span>Skip <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">match</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">match</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">match</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">⊔</span> <span class="free">match</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">match</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">match</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">OO</span> <span class="free">match</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">match</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">match</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> match_cong<span class="main">[</span><span class="operator">fundef_cong</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">r'</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">i</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> atms <span class="free">r</span> <span class="main">⟹</span> <span class="free">t</span> <span class="bound">i</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">t'</span> <span class="bound">i</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟹</span> match <span class="free">t</span> <span class="free">r</span> <span class="main">=</span> match <span class="free">t'</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">r'</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">eps</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eps</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Skip <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eps</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eps</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">eps</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∨</span> <span class="free">eps</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eps</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">eps</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> <span class="free">eps</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eps</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">lpd</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Skip <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">{}</span> <span class="main">|</span> Suc <span class="bound">m</span> <span class="main">⇒</span> <span class="main">{</span>Skip <span class="bound">m</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">lpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">lpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">lpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∪</span> <span class="free">lpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">lpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> TimesR <span class="main">(</span><span class="free">lpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> eps <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">then</span> <span class="free">lpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">lpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> TimesR <span class="main">(</span><span class="free">lpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">lpdκ</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lpdκ</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Skip <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">{}</span> <span class="main">|</span> Suc <span class="bound">m</span> <span class="main">⇒</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="main">(</span>Skip <span class="bound">m</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">lpdκ</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">lpdκ</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">lpdκ</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∪</span> <span class="free">lpdκ</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">lpdκ</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">lpdκ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="main">(</span>Times <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> eps <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">then</span> <span class="free">lpdκ</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">lpdκ</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">lpdκ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="main">(</span>Times <span class="bound">t</span> <span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">rpd</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Skip <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">{}</span> <span class="main">|</span> Suc <span class="bound">m</span> <span class="main">⇒</span> <span class="main">{</span>Skip <span class="bound">m</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">rpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∪</span> <span class="free">rpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> TimesL <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="free">rpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> eps <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">then</span> <span class="free">rpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> TimesL <span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">rpd</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">rpdκ</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rpdκ</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Skip <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">{}</span> <span class="main">|</span> Suc <span class="bound">m</span> <span class="main">⇒</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="main">(</span>Skip <span class="bound">m</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rpdκ</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rpdκ</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">rpdκ</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∪</span> <span class="free">rpdκ</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rpdκ</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">rpdκ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> eps <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">then</span> <span class="free">rpdκ</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rpdκ</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">rpdκ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="main">(</span>Times <span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">test</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lpdκ_lpd<span class="main">:</span> <span class="quoted"><span class="quoted">"lpdκ <span class="free">κ</span> <span class="free">test</span> <span class="free">i</span> <span class="free">r</span> <span class="main">=</span> <span class="free">κ</span> <span class="main">`</span> lpd <span class="free">test</span> <span class="free">i</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">κ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TimesR_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rpdκ_rpd<span class="main">:</span> <span class="quoted"><span class="quoted">"rpdκ <span class="free">κ</span> <span class="free">test</span> <span class="free">i</span> <span class="free">r</span> <span class="main">=</span> <span class="free">κ</span> <span class="main">`</span> rpd <span class="free">test</span> <span class="free">i</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">κ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TimesL_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> match_le<span class="main">:</span> <span class="quoted"><span class="quoted">"match <span class="free">test</span> <span class="free">r</span> <span class="free">i</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Times <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Star <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Star.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> match.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtranclp.induct<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Star.IH<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> match_rtranclp_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>match <span class="free">test</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">i</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> match.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> match_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eps_match<span class="main">:</span> <span class="quoted"><span class="quoted">"eps <span class="free">test</span> <span class="free">i</span> <span class="free">r</span> <span class="main">⟷</span> match <span class="free">test</span> <span class="free">r</span> <span class="free">i</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> antisym<span class="main"><span class="main">[</span></span><span class="operator">OF</span> match_le match_le<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lpd_match<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span> <span class="main">⟹</span> match <span class="free">test</span> <span class="free">r</span> <span class="free">i</span> <span class="free">j</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">s</span> <span class="main">∈</span> lpd <span class="free">test</span> <span class="free">i</span> <span class="free">r</span><span class="main">.</span> match <span class="free">test</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Times <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"match <span class="free">test</span> <span class="main">(</span>Times <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> match <span class="free">test</span> <span class="skolem">r</span> <span class="skolem">i</span> <span class="bound">k</span> <span class="main">∧</span> match <span class="free">test</span> <span class="skolem">s</span> <span class="bound">k</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> match <span class="free">test</span> <span class="skolem">r</span> <span class="skolem">i</span> <span class="skolem">i</span> <span class="main">∧</span> match <span class="free">test</span> <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="skolem">i</span><span class="main">.</span> match <span class="free">test</span> <span class="skolem">r</span> <span class="skolem">i</span> <span class="bound">k</span> <span class="main">∧</span> match <span class="free">test</span> <span class="skolem">s</span> <span class="bound">k</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> match_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">test</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> nat_less_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> match <span class="free">test</span> <span class="skolem">r</span> <span class="skolem">i</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">t</span> <span class="main">∈</span> lpd <span class="free">test</span> <span class="skolem">i</span> <span class="skolem">s</span><span class="main">.</span> match <span class="free">test</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="skolem">i</span><span class="main">.</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">t</span> <span class="main">∈</span> lpd <span class="free">test</span> <span class="skolem">i</span> <span class="skolem">r</span><span class="main">.</span> match <span class="free">test</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="bound">k</span> <span class="main">∧</span> match <span class="free">test</span> <span class="skolem">s</span> <span class="bound">k</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Times.IH<span class="main">(</span>1<span class="main">)</span> Times.IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Times.prems<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> match <span class="free">test</span> <span class="skolem">r</span> <span class="skolem">i</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">t</span> <span class="main">∈</span> lpd <span class="free">test</span> <span class="skolem">i</span> <span class="skolem">s</span><span class="main">.</span> match <span class="free">test</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">t</span> <span class="main">∈</span> lpd <span class="free">test</span> <span class="skolem">i</span> <span class="skolem">r</span><span class="main">.</span> match <span class="free">test</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="bound">k</span> <span class="main">∧</span> match <span class="free">test</span> <span class="skolem">s</span> <span class="bound">k</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Times.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> disj_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span> iff_exI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> match_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">⨆</span> <span class="main">(</span>match <span class="free">test</span> <span class="main">`</span> lpd <span class="free">test</span> <span class="skolem">i</span> <span class="main">(</span>Times <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TimesL_def TimesR_def eps_match<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Star <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">∈</span>lpd <span class="free">test</span> <span class="skolem">i</span> <span class="skolem">r</span><span class="main">.</span> <span class="main">(</span>match <span class="free">test</span> <span class="bound">s</span> <span class="keyword1">OO</span> <span class="main">(</span>match <span class="free">test</span> <span class="skolem">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>match <span class="free">test</span> <span class="skolem">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">i</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that Star.prems match_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">test</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_rtranclp_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">i</span> <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_less Star.IH <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> match_le<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> Star.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> match_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">test</span></span> <span class="main">_</span>  <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TimesL_def TimesR_def Suc_le_eq Star.IH<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> converse_rtranclp_into_rtranclp<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rpd_match<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span> <span class="main">⟹</span> match <span class="free">test</span> <span class="free">r</span> <span class="free">i</span> <span class="free">j</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">s</span> <span class="main">∈</span> rpd <span class="free">test</span> <span class="free">j</span> <span class="free">r</span><span class="main">.</span> match <span class="free">test</span> <span class="bound">s</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Times <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"match <span class="free">test</span> <span class="main">(</span>Times <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> match <span class="free">test</span> <span class="skolem">r</span> <span class="skolem">i</span> <span class="bound">k</span> <span class="main">∧</span> match <span class="free">test</span> <span class="skolem">s</span> <span class="bound">k</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> match <span class="free">test</span> <span class="skolem">r</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">∧</span> match <span class="free">test</span> <span class="skolem">s</span> <span class="skolem">j</span> <span class="skolem">j</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="skolem">j</span><span class="main">.</span> match <span class="free">test</span> <span class="skolem">r</span> <span class="skolem">i</span> <span class="bound">k</span> <span class="main">∧</span> match <span class="free">test</span> <span class="skolem">s</span> <span class="bound">k</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> match_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">test</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span> nat_less_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">t</span> <span class="main">∈</span> rpd <span class="free">test</span> <span class="skolem">j</span> <span class="skolem">r</span><span class="main">.</span> match <span class="free">test</span> <span class="bound">t</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> match <span class="free">test</span> <span class="skolem">s</span> <span class="skolem">j</span> <span class="skolem">j</span>  <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="skolem">j</span><span class="main">.</span> match <span class="free">test</span> <span class="skolem">r</span> <span class="skolem">i</span> <span class="bound">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">t</span> <span class="main">∈</span> rpd <span class="free">test</span> <span class="skolem">j</span> <span class="skolem">s</span><span class="main">.</span> match <span class="free">test</span> <span class="bound">t</span><span class="main">)</span> <span class="bound">k</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Times.IH<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Times.prems<span class="main">]</span> Times.IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">t</span> <span class="main">∈</span> rpd <span class="free">test</span> <span class="skolem">j</span> <span class="skolem">r</span><span class="main">.</span> match <span class="free">test</span> <span class="bound">t</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> match <span class="free">test</span> <span class="skolem">s</span> <span class="skolem">j</span> <span class="skolem">j</span>  <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> match <span class="free">test</span> <span class="skolem">r</span> <span class="skolem">i</span> <span class="bound">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">t</span> <span class="main">∈</span> rpd <span class="free">test</span> <span class="skolem">j</span> <span class="skolem">s</span><span class="main">.</span> match <span class="free">test</span> <span class="bound">t</span><span class="main">)</span> <span class="bound">k</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Times.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> disj_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span> iff_exI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> match_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">⨆</span> <span class="main">(</span>match <span class="free">test</span> <span class="main">`</span> rpd <span class="free">test</span> <span class="skolem">j</span> <span class="main">(</span>Times <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TimesL_def TimesR_def eps_match<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Star <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">∈</span>rpd <span class="free">test</span> <span class="skolem">j</span> <span class="skolem">r</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>match <span class="free">test</span> <span class="skolem">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="keyword1">OO</span> match <span class="free">test</span> <span class="bound">s</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>match <span class="free">test</span> <span class="skolem">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">i</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that Star.prems match_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">test</span></span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtranclp_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">k</span> <span class="skolem">j</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_less Star.IH <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> match_le<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> Star.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TimesL_def TimesR_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Star.IH<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rtranclp.rtrancl_into_rtrancl <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> match_le<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">test</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> One_nat_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lpd_fv_regex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> lpd <span class="free">test</span> <span class="free">i</span> <span class="free">r</span> <span class="main">⟹</span> fv_regex <span class="free">fv</span> <span class="free">s</span> <span class="main">⊆</span> fv_regex <span class="free">fv</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TimesR_def TimesL_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits nat.splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rpd_fv_regex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> rpd <span class="free">test</span> <span class="free">i</span> <span class="free">r</span> <span class="main">⟹</span> fv_regex <span class="free">fv</span> <span class="free">s</span> <span class="main">⊆</span> fv_regex <span class="free">fv</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TimesR_def TimesL_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits nat.splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> match_fv_cong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> atms <span class="free">r</span> <span class="main">⟹</span> <span class="free">test</span> <span class="bound">i</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">test'</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> match <span class="free">test</span> <span class="free">r</span> <span class="main">=</span> match <span class="free">test'</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> eps_fv_cong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> atms <span class="free">r</span> <span class="main">⟹</span> <span class="free">test</span> <span class="bound">i</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">test'</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> eps <span class="free">test</span> <span class="free">i</span> <span class="free">r</span> <span class="main">=</span> eps <span class="free">test'</span> <span class="free">i</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">datatype</span></span> modality <span class="main">=</span> Past <span class="main">|</span> Futu
<span class="keyword1"><span class="command">datatype</span></span> safety <span class="main">=</span> Strict <span class="main">|</span> Lax

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">fv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">safe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"safety <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">fun</span></span> <span class="entity">safe_regex</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"modality <span class="main">⇒</span> safety <span class="main">⇒</span> <span class="tfree">'a</span> regex <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">safe_regex</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">(</span>Skip <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">safe_regex</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>Test <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">safe</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">safe_regex</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> Lax <span class="main">∨</span> fv_regex <span class="free">fv</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> fv_regex <span class="free">fv</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">safe_regex</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> <span class="free">safe_regex</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">safe_regex</span> Futu <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> Lax <span class="main">∨</span> fv_regex <span class="free">fv</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">⊆</span> fv_regex <span class="free">fv</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">safe_regex</span> Futu <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="free">safe_regex</span> Futu Lax <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">safe_regex</span> Past <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> Lax <span class="main">∨</span> fv_regex <span class="free">fv</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⊆</span> fv_regex <span class="free">fv</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">safe_regex</span> Past <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> <span class="free">safe_regex</span> Past Lax <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">safe_regex</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> Lax <span class="main">∨</span> fv_regex <span class="free">fv</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="free">safe_regex</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> safe_regex_induct <span class="main">=</span> safe_regex.induct<span class="main">[</span><span class="operator">case_names</span> Skip Test Plus TimesF TimesP Star<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> safe_cosafe<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> atms <span class="free">r</span> <span class="main">⟹</span> <span class="free">safe</span> Strict <span class="bound">x</span> <span class="main">⟹</span> <span class="free">safe</span> Lax <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> safe_regex <span class="free">m</span> Strict <span class="free">r</span> <span class="main">⟹</span> safe_regex <span class="free">m</span> Lax <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> safe_lpd_fv_regex_le<span class="main">:</span> <span class="quoted"><span class="quoted">"safe_regex Futu Strict <span class="free">r</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> lpd <span class="free">test</span> <span class="free">i</span> <span class="free">r</span> <span class="main">⟹</span> fv_regex <span class="free">fv</span> <span class="free">r</span> <span class="main">⊆</span> fv_regex <span class="free">fv</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TimesR_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> safe_lpd_fv_regex<span class="main">:</span> <span class="quoted"><span class="quoted">"safe_regex Futu Strict <span class="free">r</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> lpd <span class="free">test</span> <span class="free">i</span> <span class="free">r</span> <span class="main">⟹</span> fv_regex <span class="free">fv</span> <span class="free">s</span> <span class="main">=</span> fv_regex <span class="free">fv</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_iff lpd_fv_regex safe_lpd_fv_regex_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cosafe_lpd<span class="main">:</span> <span class="quoted"><span class="quoted">"safe_regex Futu Lax <span class="free">r</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> lpd <span class="free">test</span> <span class="free">i</span> <span class="free">r</span> <span class="main">⟹</span> safe_regex Futu Lax <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Plus <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Plus<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Plus<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Times <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Times<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TimesR_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Times<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TimesR_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> safe_lpd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> atms <span class="free">r</span><span class="main">.</span> <span class="free">safe</span> Strict <span class="bound">x</span> <span class="main">⟶</span> <span class="free">safe</span> Lax <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>
  safe_regex Futu Strict <span class="free">r</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> lpd <span class="free">test</span> <span class="free">i</span> <span class="free">r</span> <span class="main">⟹</span> safe_regex Futu Strict <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Plus <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Plus<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Plus<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ball_Un<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Times <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Times<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TimesR_def ball_Un <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Times<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> cosafe_lpd <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> lpd_fv_regex <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Star <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Star<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TimesR_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Star<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> cosafe_lpd
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> safe_cosafe<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span> lpd_fv_regex<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> fv<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">fv</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> safe_rpd_fv_regex_le<span class="main">:</span> <span class="quoted"><span class="quoted">"safe_regex Past Strict <span class="free">r</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> rpd <span class="free">test</span> <span class="free">i</span> <span class="free">r</span> <span class="main">⟹</span> fv_regex <span class="free">fv</span> <span class="free">r</span> <span class="main">⊆</span> fv_regex <span class="free">fv</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TimesL_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> safe_rpd_fv_regex<span class="main">:</span> <span class="quoted"><span class="quoted">"safe_regex Past Strict <span class="free">r</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> rpd <span class="free">test</span> <span class="free">i</span> <span class="free">r</span> <span class="main">⟹</span> fv_regex <span class="free">fv</span> <span class="free">s</span> <span class="main">=</span> fv_regex <span class="free">fv</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_iff rpd_fv_regex safe_rpd_fv_regex_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cosafe_rpd<span class="main">:</span> <span class="quoted"><span class="quoted">"safe_regex Past Lax <span class="free">r</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> rpd <span class="free">test</span> <span class="free">i</span> <span class="free">r</span> <span class="main">⟹</span> safe_regex Past Lax <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Plus <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Plus<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Plus<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Times <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Times<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TimesL_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Times<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TimesL_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> safe_rpd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> atms <span class="free">r</span><span class="main">.</span> <span class="free">safe</span> Strict <span class="bound">x</span> <span class="main">⟶</span> <span class="free">safe</span> Lax <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>
  safe_regex Past Strict <span class="free">r</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> rpd <span class="free">test</span> <span class="free">i</span> <span class="free">r</span> <span class="main">⟹</span> safe_regex Past Strict <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Plus <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Plus<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Plus<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ball_Un<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Times <span class="skolem">r1</span> <span class="skolem">r2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Times<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TimesL_def ball_Un <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Times<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> cosafe_rpd <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpd_fv_regex <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Star <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Star<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TimesL_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Star<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> cosafe_rpd
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> safe_cosafe<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span> rpd_fv_regex<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> fv<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">fv</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> safe_regex_safe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">g</span> <span class="bound">r</span><span class="main">.</span> <span class="free">safe</span> <span class="bound">g</span> <span class="bound">r</span> <span class="main">⟹</span> <span class="free">safe</span> Lax <span class="bound">r</span><span class="main">)</span> <span class="main">⟹</span>
  safe_regex <span class="free">m</span> <span class="free">g</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> atms <span class="free">r</span> <span class="main">⟹</span> <span class="free">safe</span> Lax <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> safe_regex.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> safe_regex_map_regex<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">g</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> atms <span class="free">r</span> <span class="main">⟹</span> <span class="free">safe</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">⟹</span>  <span class="free">safe</span> <span class="bound">g</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> atms <span class="free">r</span> <span class="main">⟹</span> <span class="free">fv</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">fv</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>
   safe_regex <span class="free">m</span> <span class="free">g</span> <span class="free">r</span> <span class="main">⟹</span> safe_regex <span class="free">m</span> <span class="free">g</span> <span class="main">(</span>map_regex <span class="free">f</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> safe_regex.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fv_regex_alt regex.set_map<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> safe_regex_cong<span class="main">[</span><span class="operator">fundef_cong</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">g</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> atms <span class="free">r</span> <span class="main">⟹</span> <span class="free">safe</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">safe'</span> <span class="bound">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>
  Regex.safe_regex <span class="free">fv</span> <span class="free">safe</span> <span class="free">m</span> <span class="free">g</span> <span class="free">r</span> <span class="main">=</span> Regex.safe_regex <span class="free">fv</span> <span class="free">safe'</span> <span class="free">m</span> <span class="free">g</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> safe_regex.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> safe_regex_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">g</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> atms <span class="free">r</span> <span class="main">⟹</span> <span class="free">safe</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">safe'</span> <span class="bound">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>
  Regex.safe_regex <span class="free">fv</span> <span class="free">safe</span> <span class="free">m</span> <span class="free">g</span> <span class="free">r</span> <span class="main">⟹</span> Regex.safe_regex <span class="free">fv</span> <span class="free">safe'</span> <span class="free">m</span> <span class="free">g</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> safe_regex.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> match_map_regex<span class="main">:</span> <span class="quoted"><span class="quoted">"match <span class="free">t</span> <span class="main">(</span>map_regex <span class="free">f</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> match <span class="main">(</span><span class="main">λ</span><span class="bound">k</span> <span class="bound">z</span><span class="main">.</span> <span class="free">t</span> <span class="bound">k</span> <span class="main">(</span><span class="free">f</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> match_cong_strong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span> <span class="main">..&lt;</span> <span class="free">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> <span class="bound">z</span> <span class="main">∈</span> atms <span class="free">r</span> <span class="main">⟹</span> <span class="free">t</span> <span class="bound">k</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">t'</span> <span class="bound">k</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟹</span> match <span class="free">t</span> <span class="free">r</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> match <span class="free">t'</span> <span class="free">r</span> <span class="free">i</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Times <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Times.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 4 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relcompp_apply <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le_less_trans match_le less_Suc_eq_le
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Times.IH<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span> Times.IH<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span> match_le<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Star <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> match.simps
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>match <span class="free">t</span> <span class="skolem">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">i</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> match.simps<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> match_le<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>match <span class="free">t'</span> <span class="skolem">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">i</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Star.prems
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtranclp.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rtrancl_into_rtrancl <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> rtrancl_into_rtrancl<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rtranclp.rtrancl_into_rtrancl<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rtrancl_into_rtrancl.IH<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Star.IH<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span>
            <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> match_le match_rtranclp_le <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_Suc_eq_le<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>match <span class="free">t'</span> <span class="skolem">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">i</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> match.simps<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> match_le<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>match <span class="free">t</span> <span class="skolem">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">i</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Star.prems
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtranclp.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rtrancl_into_rtrancl <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> rtrancl_into_rtrancl<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rtranclp.rtrancl_into_rtrancl<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rtrancl_into_rtrancl.IH<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Star.IH<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span>
            <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> match_le match_rtranclp_le <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_Suc_eq_le<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</body>

</html>