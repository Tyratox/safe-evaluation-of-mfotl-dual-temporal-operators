<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory MFOTL</title>
</head>


<body>
<div class="head">
<h1>Theory MFOTL</h1>
</div>

<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> MFOTL
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Interval.html">Interval</a> <a href="Trace.html">Trace</a> <a href="Abstract_Monitor.html">Abstract_Monitor</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Metric first-order temporal logic›</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Formulas and satisfiability›</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">type_synonym</span></span> name <span class="main">=</span> <span class="quoted">string</span>
<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> event <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>name <span class="main">×</span> <span class="tfree">'a</span> list<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> database <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event set"</span></span>
<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> prefix <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>name <span class="main">×</span> <span class="tfree">'a</span> list<span class="main">)</span> prefix"</span></span>
<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> trace <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>name <span class="main">×</span> <span class="tfree">'a</span> list<span class="main">)</span> trace"</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> env <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> trm <span class="main">=</span> Var <span class="quoted">nat</span> <span class="main">|</span> <span class="entity">is_Const</span><span class="main">:</span> Const <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">fvi_trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> nat set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fvi_trm</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fvi_trm</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>Const <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">fv_trm</span> <span class="main">≡</span> fvi_trm <span class="main">0</span>"</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">eval_trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> env <span class="main">⇒</span> <span class="tfree">'a</span> trm <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval_trm</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_trm</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_trm_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fv_trm <span class="free">t</span><span class="main">.</span> <span class="free">v</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v'</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">⟹</span> eval_trm <span class="free">v</span> <span class="free">t</span> <span class="main">=</span> eval_trm <span class="free">v'</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span>discs_sels<span class="main">)</span> <span class="tfree">'a</span> formula <span class="main">=</span> Pred <span class="quoted">name</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm list"</span></span> <span class="main">|</span> Eq <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trm"</span></span>
  <span class="main">|</span> Neg <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="main">|</span> Or <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="main">|</span> Exists <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span>
  <span class="main">|</span> Prev <span class="quoted">ℐ</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="main">|</span> Next <span class="quoted">ℐ</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span>
  <span class="main">|</span> Since <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="quoted">ℐ</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="main">|</span> Until <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span> <span class="quoted">ℐ</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula"</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">fvi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> formula <span class="main">⇒</span> nat set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fvi</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>Pred <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">t</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">.</span> fvi_trm <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fvi</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="main">=</span> fvi_trm <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">∪</span> fvi_trm <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fvi</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fvi</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fvi</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fvi</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">fvi</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fvi</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fvi</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fvi</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>Prev <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fvi</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fvi</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>Next <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fvi</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fvi</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>Since <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fvi</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">fvi</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fvi</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>Until <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fvi</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">fvi</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">fv</span> <span class="main">≡</span> fvi <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_fvi_trm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>fvi_trm <span class="free">b</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_fvi<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>fvi <span class="free">b</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> fvi_trm_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> fvi_trm <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span> <span class="free">t</span> <span class="main">⟷</span> Suc <span class="free">x</span> <span class="main">∈</span> fvi_trm <span class="free">b</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fvi_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> fvi <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span> <span class="free">φ</span> <span class="main">⟷</span> Suc <span class="free">x</span> <span class="main">∈</span> fvi <span class="free">b</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fvi_trm_Suc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fvi_Suc_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>fvi <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span> <span class="free">φ</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>fvi <span class="free">b</span> <span class="free">φ</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> fvi <span class="free">b</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fvi_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">nfv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nfv</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> Max <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>Suc <span class="main">`</span> fv <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">envs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula <span class="main">⇒</span> <span class="tfree">'a</span> env set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">envs</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> length <span class="bound">v</span> <span class="main">=</span> nfv <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nfv_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"nfv <span class="main">(</span>Neg <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> nfv <span class="free">φ</span>"</span></span>
  <span class="quoted"><span class="quoted">"nfv <span class="main">(</span>Or <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>nfv <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>nfv <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"nfv <span class="main">(</span>Prev <span class="free">I</span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> nfv <span class="free">φ</span>"</span></span>
  <span class="quoted"><span class="quoted">"nfv <span class="main">(</span>Next <span class="free">I</span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> nfv <span class="free">φ</span>"</span></span>
  <span class="quoted"><span class="quoted">"nfv <span class="main">(</span>Since <span class="free">φ</span> <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>nfv <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>nfv <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"nfv <span class="main">(</span>Until <span class="free">φ</span> <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>nfv <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>nfv <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nfv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_Un Max_Un<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fvi_less_nfv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>fv <span class="free">φ</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> nfv <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nfv_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Max_gr_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> max.strict_coboundedI2<span class="main">)</span>


<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">future_bounded</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">future_bounded</span> <span class="main">(</span>Pred <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">future_bounded</span> <span class="main">(</span>Eq <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">future_bounded</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">future_bounded</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">future_bounded</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">future_bounded</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> <span class="free">future_bounded</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">future_bounded</span> <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">future_bounded</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">future_bounded</span> <span class="main">(</span>Prev <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">future_bounded</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">future_bounded</span> <span class="main">(</span>Next <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">future_bounded</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">future_bounded</span> <span class="main">(</span>Since <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">future_bounded</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> <span class="free">future_bounded</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">future_bounded</span> <span class="main">(</span>Until <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">future_bounded</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> <span class="free">future_bounded</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∧</span> bounded <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">sat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trace <span class="main">⇒</span> <span class="tfree">'a</span> env <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> formula <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Pred <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> map <span class="main">(</span>eval_trm <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">∈</span> Γ <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>eval_trm <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">=</span> eval_trm <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∨</span> <span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span><span class="bound">z</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Prev <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> False <span class="main">|</span> Suc <span class="bound">j</span> <span class="main">⇒</span> mem <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>τ <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> τ <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">j</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Next <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mem <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>τ <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">-</span> τ <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Since <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">.</span> mem <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>τ <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> τ <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">j</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">j</span> <span class="main">&lt;..</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">}</span><span class="main">.</span> <span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="bound">k</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>Until <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">.</span> mem <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>τ <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">j</span> <span class="main">-</span> τ <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">..&lt;</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span> <span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="bound">k</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sat_Until_rec<span class="main">:</span> <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="main">(</span>Until <span class="free">φ</span> <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span>
  <span class="main">(</span>memL <span class="free">I</span> <span class="main">0</span> <span class="main">∧</span> sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="free">ψ</span> <span class="main">∨</span>
  memR <span class="free">I</span> <span class="main">(</span>Δ <span class="free">σ</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="free">φ</span> <span class="main">∧</span> sat <span class="free">σ</span> <span class="free">v</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Until <span class="free">φ</span> <span class="main">(</span>subtract <span class="main">(</span>Δ <span class="free">σ</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">elim</span> disjE conjE<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"mem <span class="free">I</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="skolem">j</span> <span class="main">-</span> τ <span class="free">σ</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="skolem">j</span> <span class="free">ψ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span> <span class="main">..&lt;</span> <span class="skolem">j</span><span class="main">}</span><span class="main">.</span> sat <span class="free">σ</span> <span class="free">v</span> <span class="bound">k</span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> j<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"memR <span class="free">I</span> <span class="main">(</span>Δ <span class="free">σ</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> diff_le_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> False j<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="free">φ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> False j <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Until <span class="free">φ</span> <span class="main">(</span>subtract <span class="main">(</span>Δ <span class="free">σ</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> Δ<span class="main">:</span> <span class="quoted"><span class="quoted">"memR <span class="free">I</span> <span class="main">(</span>Δ <span class="free">σ</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> now<span class="main">:</span> <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted">"next"</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Until <span class="free">φ</span> <span class="main">(</span>subtract <span class="main">(</span>Δ <span class="free">σ</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"next"</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"mem <span class="main">(</span><span class="main">(</span>subtract <span class="main">(</span>Δ <span class="free">σ</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="skolem">j</span> <span class="main">-</span> τ <span class="free">σ</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="skolem">j</span> <span class="free">ψ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">..&lt;</span> <span class="skolem">j</span><span class="main">}</span><span class="main">.</span> sat <span class="free">σ</span> <span class="free">v</span> <span class="bound">k</span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> diff_le_mono memL_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Δ j<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mem <span class="free">I</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="skolem">j</span> <span class="main">-</span> τ <span class="free">σ</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> now j<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_eq_less_or_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sat_Since_rec<span class="main">:</span> <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="main">(</span>Since <span class="free">φ</span> <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span>
  memL <span class="free">I</span> <span class="main">0</span> <span class="main">∧</span> sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="free">ψ</span> <span class="main">∨</span>
  <span class="main">(</span><span class="free">i</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> memR <span class="free">I</span> <span class="main">(</span>Δ <span class="free">σ</span> <span class="free">i</span><span class="main">)</span> <span class="main">∧</span> sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="free">φ</span> <span class="main">∧</span> sat <span class="free">σ</span> <span class="free">v</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Since <span class="free">φ</span> <span class="main">(</span>subtract <span class="main">(</span>Δ <span class="free">σ</span> <span class="free">i</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">elim</span> disjE conjE<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"mem <span class="free">I</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="free">i</span> <span class="main">-</span> τ <span class="free">σ</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="skolem">j</span> <span class="free">ψ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">j</span> <span class="main">&lt;..</span> <span class="free">i</span><span class="main">}</span><span class="main">.</span> sat <span class="free">σ</span> <span class="free">v</span> <span class="bound">k</span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> j<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> j<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"memR <span class="free">I</span> <span class="main">(</span>Δ <span class="free">σ</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> diff_le_mono2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> False j<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="free">φ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> False j <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Since <span class="free">φ</span> <span class="main">(</span>subtract <span class="main">(</span>Δ <span class="free">σ</span> <span class="free">i</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Δ<span class="main">:</span> <span class="quoted"><span class="quoted">"memR <span class="free">I</span> <span class="main">(</span>Δ <span class="free">σ</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> now<span class="main">:</span> <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted">"prev"</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Since <span class="free">φ</span> <span class="main">(</span>subtract <span class="main">(</span>Δ <span class="free">σ</span> <span class="free">i</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"prev"</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"mem <span class="main">(</span><span class="main">(</span>subtract <span class="main">(</span>Δ <span class="free">σ</span> <span class="free">i</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> τ <span class="free">σ</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="skolem">j</span> <span class="free">ψ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">j</span> <span class="main">&lt;..</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> sat <span class="free">σ</span> <span class="free">v</span> <span class="bound">k</span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> diff_le_mono2 memL_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Δ i j<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mem <span class="free">I</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="free">i</span> <span class="main">-</span> τ <span class="free">σ</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> now i j<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_Suc_eq gr0_conv_Suc <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sat_Since_0<span class="main">:</span> <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="main">0</span> <span class="main">(</span>Since <span class="free">φ</span> <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟷</span> memL <span class="free">I</span> <span class="main">0</span> <span class="main">∧</span> sat <span class="free">σ</span> <span class="free">v</span> <span class="main">0</span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sat_Since_point<span class="main">:</span> <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="main">(</span>Since <span class="free">φ</span> <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">⟹</span> mem <span class="free">I</span> <span class="main">(</span>τ <span class="free">σ</span> <span class="free">i</span> <span class="main">-</span> τ <span class="free">σ</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⟹</span> sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="main">(</span>Since <span class="free">φ</span> <span class="main">(</span>point <span class="main">(</span>τ <span class="free">σ</span> <span class="free">i</span> <span class="main">-</span> τ <span class="free">σ</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> diff_le_self<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sat_Since_pointD<span class="main">:</span> <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="main">(</span>Since <span class="free">φ</span> <span class="main">(</span>point <span class="free">t</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟹</span> mem <span class="free">I</span> <span class="free">t</span> <span class="main">⟹</span> sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="main">(</span>Since <span class="free">φ</span> <span class="free">I</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_trm_fvi_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fv_trm <span class="free">t</span><span class="main">.</span> <span class="free">v</span><span class="main">!</span><span class="bound">x</span> <span class="main">=</span> <span class="free">v'</span><span class="main">!</span><span class="bound">x</span> <span class="main">⟹</span> eval_trm <span class="free">v</span> <span class="free">t</span> <span class="main">=</span> eval_trm <span class="free">v'</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> sat_fvi_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fv <span class="free">φ</span><span class="main">.</span> <span class="free">v</span><span class="main">!</span><span class="bound">x</span> <span class="main">=</span> <span class="free">v'</span><span class="main">!</span><span class="bound">x</span> <span class="main">⟹</span> sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="free">φ</span> <span class="main">=</span> sat <span class="free">σ</span> <span class="free">v'</span> <span class="free">i</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">v'</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pred <span class="skolem">n</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> map_cong eval_trm_fvi_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Pred<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">simplified</span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">THEN</span> bspec<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Eq <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">unfolding</span></span> fvi.simps sat.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UnCI eval_trm_fvi_cong<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Exists <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sat.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> iff_exI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fvi_Suc nth_Cons'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> 8 0 <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons' <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> iff_exI<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Defined connectives›</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">And</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> Neg <span class="main">(</span>Or <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fvi_And<span class="main">:</span> <span class="quoted"><span class="quoted">"fvi <span class="free">b</span> <span class="main">(</span>And <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> fvi <span class="free">b</span> <span class="free">φ</span> <span class="main">∪</span> fvi <span class="free">b</span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> And_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> nfv_And<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nfv <span class="main">(</span>And <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>nfv <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>nfv <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nfv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fvi_And image_Un Max_Un<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> future_reach_And<span class="main">:</span> <span class="quoted"><span class="quoted">"future_bounded <span class="main">(</span>And <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>future_bounded <span class="free">φ</span> <span class="main">∧</span> future_bounded <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> And_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> sat_And<span class="main">:</span> <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="main">(</span>And <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="free">φ</span> <span class="main">∧</span> sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> And_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">And_Not</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> Neg <span class="main">(</span>Or <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fvi_And_Not<span class="main">:</span> <span class="quoted"><span class="quoted">"fvi <span class="free">b</span> <span class="main">(</span>And_Not <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> fvi <span class="free">b</span> <span class="free">φ</span> <span class="main">∪</span> fvi <span class="free">b</span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> And_Not_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> nfv_And_Not<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nfv <span class="main">(</span>And_Not <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>nfv <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>nfv <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nfv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fvi_And_Not image_Un Max_Un<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> future_reach_And_Not<span class="main">:</span> <span class="quoted"><span class="quoted">"future_bounded <span class="main">(</span>And_Not <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>future_bounded <span class="free">φ</span> <span class="main">∧</span> future_bounded <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> And_Not_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> sat_And_Not<span class="main">:</span> <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="main">(</span>And_Not <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="free">φ</span> <span class="main">∧</span> <span class="main">¬</span> sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> And_Not_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Safe formulas›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">safe_formula</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> MFOTL.formula <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">safe_formula</span> <span class="main">(</span>MFOTL.Eq <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>MFOTL.is_Const <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">∨</span> MFOTL.is_Const <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">safe_formula</span> <span class="main">(</span>MFOTL.Neg <span class="main">(</span>MFOTL.Eq <span class="main">(</span>MFOTL.Const <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>MFOTL.Const <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">safe_formula</span> <span class="main">(</span>MFOTL.Neg <span class="main">(</span>MFOTL.Eq <span class="main">(</span>MFOTL.Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>MFOTL.Var <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">safe_formula</span> <span class="main">(</span>MFOTL.Pred <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">safe_formula</span> <span class="main">(</span>MFOTL.Neg <span class="main">(</span>MFOTL.Or <span class="main">(</span>MFOTL.Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">safe_formula</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span>
    <span class="main">(</span><span class="free">safe_formula</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∧</span> MFOTL.fv <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">⊆</span> MFOTL.fv <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∨</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">of</span> MFOTL.Neg <span class="bound">ψ'</span> <span class="main">⇒</span> <span class="free">safe_formula</span> <span class="bound">ψ'</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">safe_formula</span> <span class="main">(</span>MFOTL.Or <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>MFOTL.fv <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">=</span> MFOTL.fv <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> <span class="free">safe_formula</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∧</span> <span class="free">safe_formula</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">safe_formula</span> <span class="main">(</span>MFOTL.Exists <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">safe_formula</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">safe_formula</span> <span class="main">(</span>MFOTL.Prev <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">safe_formula</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">safe_formula</span> <span class="main">(</span>MFOTL.Next <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">safe_formula</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">safe_formula</span> <span class="main">(</span>MFOTL.Since <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>MFOTL.fv <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">⊆</span> MFOTL.fv <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∧</span>
    <span class="main">(</span><span class="free">safe_formula</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∨</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">of</span> MFOTL.Neg <span class="bound">φ'</span> <span class="main">⇒</span> <span class="free">safe_formula</span> <span class="bound">φ'</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">safe_formula</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">safe_formula</span> <span class="main">(</span>MFOTL.Until <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>MFOTL.fv <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">⊆</span> MFOTL.fv <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">∧</span>
    <span class="main">(</span><span class="free">safe_formula</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∨</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">of</span> MFOTL.Neg <span class="bound">φ'</span> <span class="main">⇒</span> <span class="free">safe_formula</span> <span class="bound">φ'</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">safe_formula</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">safe_formula</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> disjE_Not2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">⟹</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">¬</span><span class="free">P</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> safe_formula_induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"safe_formula <span class="free">φ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> MFOTL.is_Const <span class="bound">t1</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>MFOTL.Eq <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> MFOTL.is_Const <span class="bound">t2</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>MFOTL.Eq <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>MFOTL.Neg <span class="main">(</span>MFOTL.Eq <span class="main">(</span>MFOTL.Const <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>MFOTL.Const <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>MFOTL.Neg <span class="main">(</span>MFOTL.Eq <span class="main">(</span>MFOTL.Var <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>MFOTL.Var <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span> <span class="bound">ts</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>MFOTL.Pred <span class="bound">e</span> <span class="bound">ts</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">ψ</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>safe_formula <span class="main">(</span>MFOTL.Neg <span class="bound">ψ</span><span class="main">)</span> <span class="main">∧</span> MFOTL.fv <span class="bound">ψ</span> <span class="main">⊆</span> MFOTL.fv <span class="bound">φ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">ψ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>MFOTL.And <span class="bound">φ</span> <span class="bound">ψ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">ψ</span><span class="main">.</span> safe_formula <span class="bound">ψ</span> <span class="main">⟹</span> MFOTL.fv <span class="bound">ψ</span> <span class="main">⊆</span> MFOTL.fv <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">ψ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>MFOTL.And_Not <span class="bound">φ</span> <span class="bound">ψ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">ψ</span><span class="main">.</span> MFOTL.fv <span class="bound">ψ</span> <span class="main">=</span> MFOTL.fv <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">ψ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>MFOTL.Or <span class="bound">φ</span> <span class="bound">ψ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> <span class="free">P</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>MFOTL.Exists <span class="bound">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">φ</span><span class="main">.</span> <span class="free">P</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>MFOTL.Prev <span class="bound">I</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">φ</span><span class="main">.</span> <span class="free">P</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>MFOTL.Next <span class="bound">I</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">I</span> <span class="bound">ψ</span><span class="main">.</span> MFOTL.fv <span class="bound">φ</span> <span class="main">⊆</span> MFOTL.fv <span class="bound">ψ</span> <span class="main">⟹</span> safe_formula <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">ψ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>MFOTL.Since <span class="bound">φ</span> <span class="bound">I</span> <span class="bound">ψ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">I</span> <span class="bound">ψ</span><span class="main">.</span> MFOTL.fv <span class="main">(</span>MFOTL.Neg <span class="bound">φ</span><span class="main">)</span> <span class="main">⊆</span> MFOTL.fv <span class="bound">ψ</span> <span class="main">⟹</span>
      <span class="main">¬</span> safe_formula <span class="main">(</span>MFOTL.Neg <span class="bound">φ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">ψ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>MFOTL.Since <span class="main">(</span>MFOTL.Neg <span class="bound">φ</span><span class="main">)</span> <span class="bound">I</span> <span class="bound">ψ</span> <span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">I</span> <span class="bound">ψ</span><span class="main">.</span> MFOTL.fv <span class="bound">φ</span> <span class="main">⊆</span> MFOTL.fv <span class="bound">ψ</span> <span class="main">⟹</span> safe_formula <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">ψ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>MFOTL.Until <span class="bound">φ</span> <span class="bound">I</span> <span class="bound">ψ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">I</span> <span class="bound">ψ</span><span class="main">.</span> MFOTL.fv <span class="main">(</span>MFOTL.Neg <span class="bound">φ</span><span class="main">)</span> <span class="main">⊆</span> MFOTL.fv <span class="bound">ψ</span> <span class="main">⟹</span>
      <span class="main">¬</span> safe_formula <span class="main">(</span>MFOTL.Neg <span class="bound">φ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">ψ</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>MFOTL.Until <span class="main">(</span>MFOTL.Neg <span class="bound">φ</span><span class="main">)</span> <span class="bound">I</span> <span class="bound">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> safe_formula.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ψ</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> disjE_Not2 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> MFOTL.And_def MFOTL.And_Not_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>10 <span class="skolem">φ</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> disjE_Not2 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>11 <span class="skolem">φ</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> disjE_Not2 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Slicing traces›</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">primrec</span></span> <span class="entity">matches</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> env <span class="main">⇒</span> <span class="tfree">'a</span> formula <span class="main">⇒</span> name <span class="main">×</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">matches</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Pred <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∧</span> map <span class="main">(</span>eval_trm <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> snd <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">matches</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Eq <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">matches</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="free">matches</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">matches</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">matches</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∨</span> <span class="free">matches</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">matches</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free">matches</span> <span class="main">(</span><span class="bound">z</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">matches</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Prev <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="free">matches</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">matches</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Next <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="free">matches</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">matches</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Since <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">matches</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∨</span> <span class="free">matches</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">matches</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Until <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">matches</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∨</span> <span class="free">matches</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> matches_fvi_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fv <span class="free">φ</span><span class="main">.</span> <span class="free">v</span><span class="main">!</span><span class="bound">x</span> <span class="main">=</span> <span class="free">v'</span><span class="main">!</span><span class="bound">x</span> <span class="main">⟹</span> matches <span class="free">v</span> <span class="free">φ</span> <span class="free">e</span> <span class="main">=</span> matches <span class="free">v'</span> <span class="free">φ</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">v'</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pred <span class="skolem">n</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> map_cong eval_trm_fvi_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Pred<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">simplified</span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">THEN</span> bspec<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Exists <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> matches.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> iff_exI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fvi_Suc nth_Cons'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> 5 0 <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons'<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">relevant_events</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">relevant_events</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">e</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∩</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> matches <span class="bound">v</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="bound">e</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sat_slice_strong<span class="main">:</span> <span class="quoted"><span class="quoted">"relevant_events <span class="free">φ</span> <span class="free">S</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span>
  sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="free">φ</span> <span class="main">⟷</span> sat <span class="main">(</span>map_Γ <span class="main">(</span><span class="main">λ</span><span class="bound">D</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∩</span> <span class="free">E</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">v</span> <span class="free">i</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pred <span class="skolem">r</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Eq <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sat.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Or.IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">S</span></span></span></span><span class="main">]</span> Or.prems
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Collect_disj_eq Int_Un_distrib subset_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Exists <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sat <span class="free">σ</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">φ</span> <span class="main">=</span> sat <span class="main">(</span>map_Γ <span class="main">(</span><span class="main">λ</span><span class="bound">D</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∩</span> <span class="free">E</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">φ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
    <span class="keyword1"><span class="command">using</span></span> Exists.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Exists.IH<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">z</span> <span class="main">#</span> <span class="bound">v</span> <span class="main">|</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">S</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Prev <span class="skolem">I</span> <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> nat.case_cong<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Next <span class="skolem">I</span> <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Since <span class="skolem">φ</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Since.IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">S</span></span></span></span><span class="main">]</span> Since.prems
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Collect_disj_eq Int_Un_distrib subset_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Until <span class="skolem">φ</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Until.IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">S</span></span></span></span><span class="main">]</span> Until.prems
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Collect_disj_eq Int_Un_distrib subset_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(*context*)</span>

<span class="keyword1"><span class="command">interpretation</span></span> MFOTL_slicer<span class="main">:</span> abstract_slicer <span class="quoted"><span class="quoted">"relevant_events <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">φ</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sat_slice_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"MFOTL.sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="free">φ</span> <span class="main">⟷</span> MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="free">φ</span> <span class="free">S</span> <span class="free">σ</span><span class="main">)</span> <span class="free">v</span> <span class="free">i</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sat_slice_strong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> subset_refl assms<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> slice_replace_prefix<span class="main">:</span>
  <span class="quoted"><span class="quoted">"prefix_of <span class="main">(</span>MFOTL_slicer.pslice <span class="free">φ</span> <span class="free">R</span> <span class="free">π</span><span class="main">)</span> <span class="free">σ</span> <span class="main">⟹</span>
    MFOTL_slicer.slice <span class="free">φ</span> <span class="free">R</span> <span class="main">(</span>replace_prefix <span class="free">π</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> MFOTL_slicer.slice <span class="free">φ</span> <span class="free">R</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> map_Γ_replace_prefix<span class="main">)</span> <span class="operator">auto</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span></pre>
</body>

</html>