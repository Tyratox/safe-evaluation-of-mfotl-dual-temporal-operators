<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Slicing</title>
</head>


<body>
<div class="head">
<h1>Theory Slicing</h1>
</div>

<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Slicing
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Abstract_Monitor.html">Abstract_Monitor</a> <a href="MFOTL.html">MFOTL</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Slicing framework›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This section formalizes the abstract slicing framework and the joint data slicer
  presented in the article~\cite[Sections 4.2 and~4.3]{SchneiderBBKT-STTT20}.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Abstract slicing›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Definition 1›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Corresponds to locale <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">locale</span></span> monitor<span class="antiquote"><span class="antiquote">}</span></span></span></span> defined in theory
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="Abstract_Monitor.html"><a href="Abstract_Monitor.html">MFOTL_Monitor_Devel.Abstract_Monitor</a></a><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Definition 2›</span></span>

<span class="keyword1"><span class="command">locale</span></span> slicer <span class="main">=</span> monitor <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">submonitor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'k</span> <span class="main">::</span> finite <span class="main">⇒</span> <span class="tfree">'a</span> prefix <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> <span class="tfree">'b</span> option list<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">splitter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> prefix <span class="main">⇒</span> <span class="tfree">'k</span> <span class="main">⇒</span> <span class="tfree">'a</span> prefix"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">joiner</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'k</span> <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> <span class="tfree">'b</span> option list<span class="main">)</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> <span class="tfree">'b</span> option list<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> mono_splitter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">π</span> <span class="main">≤</span> <span class="free">π'</span> <span class="main">⟹</span> <span class="free">splitter</span> <span class="free">π</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">splitter</span> <span class="free">π'</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   correct_slicer<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">joiner</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">submonitor</span> <span class="bound">k</span> <span class="main">(</span><span class="free">splitter</span> <span class="free">π</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span> <span class="free">π</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> sound_slicer <span class="main">=</span> equalityD1<span class="main">[</span><span class="operator">OF</span> correct_slicer<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> complete_slicer <span class="main">=</span> equalityD2<span class="main">[</span><span class="operator">OF</span> correct_slicer<span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> self_slicer <span class="main">=</span> slicer <span class="quoted"><span class="free">nfv</span></span> <span class="quoted"><span class="free">fv</span></span> <span class="quoted"><span class="free">sat</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="free">splitter</span></span> <span class="quoted"><span class="free">joiner</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">nfv</span> <span class="free">fv</span> <span class="free">sat</span> <span class="free">M</span> <span class="free">splitter</span> <span class="free">joiner</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Definition 3›</span></span>

<span class="keyword1"><span class="command">locale</span></span> event_separable_splitter <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">event_splitter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'k</span> <span class="main">::</span> finite set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> splitter <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> prefix <span class="main">⇒</span> <span class="tfree">'k</span> <span class="main">⇒</span> <span class="tfree">'a</span> prefix"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">π</span> <span class="bound">k</span><span class="main">.</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">D</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> <span class="bound">D</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="free">event_splitter</span> <span class="bound">e</span><span class="main">}</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="bound">π</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def split_beta<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Lemma 1›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_splitter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">π</span> <span class="main">≤</span> <span class="free">π'</span> <span class="main">⟹</span> splitter <span class="free">π</span> <span class="free">k</span> <span class="main">≤</span> splitter <span class="free">π'</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Joint data slicer›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">ok</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> wf_tuple <span class="main">(</span>MFOTL.nfv <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span>MFOTL.fv <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> splitting_strategy <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">φ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> MFOTL.formula"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">strategy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> option list <span class="main">⇒</span> <span class="tfree">'k</span> <span class="main">::</span> finite set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> strategy_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"ok <span class="free">φ</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">strategy</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">slice_set</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">slice_set</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> map the <span class="bound">v'</span> <span class="main">=</span> <span class="bound">v</span> <span class="main">∧</span> ok <span class="free">φ</span> <span class="bound">v'</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∈</span> <span class="free">strategy</span> <span class="bound">v'</span><span class="main">}</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Definition 4›</span></span>

<span class="keyword1"><span class="command">locale</span></span> MFOTL_monitor <span class="main">=</span>
  monitor <span class="quoted"><span class="quoted">"MFOTL.nfv <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"MFOTL.fv <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">σ</span> <span class="bound">v</span> <span class="bound">i</span><span class="main">.</span> MFOTL.sat <span class="bound">σ</span> <span class="bound">v</span> <span class="bound">i</span> <span class="free">φ</span>"</span></span> <span class="quoted"><span class="free">M</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">φ</span> <span class="free">M</span>

<span class="keyword1"><span class="command">locale</span></span> joint_data_slicer <span class="main">=</span> MFOTL_monitor <span class="quoted"><span class="free">φ</span></span> <span class="quoted"><span class="free">M</span></span> <span class="main">+</span> splitting_strategy <span class="quoted"><span class="free">φ</span></span> <span class="quoted"><span class="free">strategy</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">φ</span> <span class="free">M</span> <span class="free">strategy</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">event_splitter</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">event_splitter</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="free">strategy</span> <span class="main">`</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> ok <span class="free">φ</span> <span class="bound">v</span> <span class="main">∧</span> MFOTL.matches <span class="main">(</span>map the <span class="bound">v</span><span class="main">)</span> <span class="free">φ</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> event_separable_splitter <span class="keyword2"><span class="keyword">where</span></span> event_splitter <span class="main">=</span> <span class="quoted">event_splitter</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">joiner</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">joiner</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">k</span><span class="main">.</span> <span class="bound">s</span> <span class="bound">k</span> <span class="main">∩</span> <span class="main">(</span>UNIV <span class="main">::</span> nat set<span class="main">)</span> <span class="main">×</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="free">strategy</span> <span class="bound">v</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> splitter_pslice<span class="main">:</span> <span class="quoted"><span class="quoted">"splitter <span class="free">π</span> <span class="free">k</span> <span class="main">=</span> MFOTL_slicer.pslice <span class="free">φ</span> <span class="main">(</span>slice_set <span class="free">k</span><span class="main">)</span> <span class="free">π</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> event_splitter_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Lemma 2›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Corresponds to the following theorem <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source] sat_slice_strong<span class="antiquote"><span class="antiquote">}</span></span></span></span> proved in theory
   <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="Abstract_Monitor.html"><a href="Abstract_Monitor.html">MFOTL_Monitor_Devel.Abstract_Monitor</a></a><span class="antiquote"><span class="antiquote">}</span></span></span></span>:

   <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> sat_slice_strong<span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> joint_monitor<span class="main">:</span> MFOTL_monitor <span class="quoted"><span class="free">φ</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">π</span><span class="main">.</span> joiner <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">M</span> <span class="main">(</span>splitter <span class="bound">π</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> mono wf sound complete<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>mono <span class="skolem">π</span> <span class="skolem">π'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> mono_monitor<span class="main">[</span><span class="operator">OF</span> mono_splitter<span class="main">,</span> <span class="operator">OF</span> mono<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> joiner_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wf <span class="skolem">i</span> <span class="skolem">v</span> <span class="skolem">π</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> in_M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">(</span>splitter <span class="skolem">π</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">strategy</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> joiner_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> wf_monitor<span class="main">[</span><span class="operator">OF</span> in_M<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sound <span class="skolem">i</span> <span class="skolem">v</span> <span class="skolem">π</span> <span class="skolem">σ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> in_M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">(</span>splitter <span class="skolem">π</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">strategy</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> joiner_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"ok <span class="free">φ</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">σ</span><span class="main">.</span> prefix_of <span class="main">(</span>splitter <span class="skolem">π</span> <span class="skolem">k</span><span class="main">)</span> <span class="bound">σ</span> <span class="main">⟹</span> MFOTL.sat <span class="bound">σ</span> <span class="main">(</span>map the <span class="skolem">v</span><span class="main">)</span> <span class="skolem">i</span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sound_monitor<span class="main">[</span><span class="operator">OF</span> in_M<span class="main">]</span> wf_monitor<span class="main">[</span><span class="operator">OF</span> in_M<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"MFOTL.sat <span class="skolem">σ</span> <span class="main">(</span>map the <span class="skolem">v</span><span class="main">)</span> <span class="skolem">i</span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"prefix_of <span class="skolem">π</span> <span class="skolem">σ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">σ</span>
    <span class="keyword1"><span class="command">using</span></span> that k
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> iffD2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sat_slice_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"map the <span class="skolem"><span class="skolem"><span class="skolem">v</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"slice_set <span class="skolem"><span class="skolem"><span class="skolem">k</span></span></span>"</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">σ</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">φ</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wf_tuple_def fvi_less_nfv splitter_pslice <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="main">]</span></span> prefix_of_pmap_Γ<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> sound<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>complete <span class="skolem">π</span> <span class="skolem">σ</span> <span class="skolem">v</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> strategy_nonempty <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">strategy</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"MFOTL.sat <span class="skolem">σ'</span> <span class="main">(</span>map the <span class="skolem">v</span><span class="main">)</span> <span class="skolem">i</span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"prefix_of <span class="main">(</span>MFOTL_slicer.pslice <span class="free">φ</span> <span class="main">(</span>slice_set <span class="skolem">k</span><span class="main">)</span> <span class="skolem">π</span><span class="main">)</span> <span class="skolem">σ'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">σ'</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"MFOTL.sat <span class="skolem">σ'</span> <span class="main">(</span>map the <span class="skolem">v</span><span class="main">)</span> <span class="skolem">i</span> <span class="free">φ</span> <span class="main">=</span> MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="free">φ</span> <span class="main">(</span>slice_set <span class="skolem">k</span><span class="main">)</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>map the <span class="skolem">v</span><span class="main">)</span> <span class="skolem">i</span> <span class="free">φ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> complete<span class="main">(</span>2<span class="main">)</span> k <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sat_slice_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="free">φ</span> <span class="main">(</span>slice_set <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>replace_prefix <span class="skolem">π</span> <span class="skolem">σ'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map the <span class="skolem">v</span><span class="main">)</span> <span class="skolem">i</span> <span class="free">φ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that complete k <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> slice_replace_prefix<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> MFOTL.sat <span class="main">(</span>replace_prefix <span class="skolem">π</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">(</span>map the <span class="skolem">v</span><span class="main">)</span> <span class="skolem">i</span> <span class="free">φ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> complete<span class="main">(</span>2<span class="main">)</span> k <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sat_slice_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> complete<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prefix_of_replace_prefix<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> complete<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">π'</span></span> <span class="keyword2"><span class="keyword">where</span></span> π'<span class="main">:</span>
    <span class="quoted"><span class="quoted">"prefix_of <span class="skolem">π'</span> <span class="main">(</span>MFOTL_slicer.slice <span class="free">φ</span> <span class="main">(</span>slice_set <span class="skolem">k</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">M</span> <span class="skolem">π'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> complete_monitor<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> π<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"MFOTL_slicer.pslice <span class="free"><span class="free"><span class="free">φ</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span>slice_set <span class="skolem"><span class="skolem"><span class="skolem">k</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">π</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> splitter_pslice <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prefix_of_pmap_Γ<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> π'<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">π''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π'</span> <span class="main">=</span> MFOTL_slicer.pslice <span class="free">φ</span> <span class="main">(</span>slice_set <span class="skolem">k</span><span class="main">)</span> <span class="skolem">π''</span>"</span></span> <span class="quoted"><span class="quoted">"prefix_of <span class="skolem">π''</span> <span class="skolem">σ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prefix_of_map_Γ_D<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> π' k <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">π''</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> joiner_def splitter_pslice <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Corollary 1›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> joint_slicer<span class="main">:</span> slicer <span class="quoted"><span class="quoted">"MFOTL.nfv <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"MFOTL.fv <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">σ</span> <span class="bound">v</span> <span class="bound">i</span><span class="main">.</span> MFOTL.sat <span class="bound">σ</span> <span class="bound">v</span> <span class="bound">i</span> <span class="free">φ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">π</span><span class="main">.</span> joiner <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">M</span> <span class="main">(</span>splitter <span class="bound">π</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">M</span>"</span></span> <span class="quoted">splitter</span> <span class="quoted">joiner</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mono_splitter<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Definition 5›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Corresponds to locale <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">locale</span></span> sliceable_monitor<span class="antiquote"><span class="antiquote">}</span></span></span></span> defined in theory
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="Abstract_Monitor.html"><a href="Abstract_Monitor.html">MFOTL_Monitor_Devel.Abstract_Monitor</a></a><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> slicable_joint_data_slicer <span class="main">=</span>
  sliceable_monitor <span class="quoted"><span class="quoted">"MFOTL.nfv <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"MFOTL.fv <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"relevant_events <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">σ</span> <span class="bound">v</span> <span class="bound">i</span><span class="main">.</span> MFOTL.sat <span class="bound">σ</span> <span class="bound">v</span> <span class="bound">i</span> <span class="free">φ</span>"</span></span> <span class="quoted"><span class="free">M</span></span> <span class="main">+</span>
  joint_data_slicer <span class="quoted"><span class="free">φ</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">strategy</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">φ</span> <span class="free">M</span> <span class="free">strategy</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> monitor_split<span class="main">:</span> <span class="quoted"><span class="quoted">"ok <span class="free">φ</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">∈</span> <span class="free">strategy</span> <span class="free">v</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">(</span>splitter <span class="free">π</span> <span class="free">k</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">M</span> <span class="free">π</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> splitter_pslice
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sliceable_M<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wf_tuple_def fvi_less_nfv <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mem_restrI<span class="main"><span class="main">[</span></span><span class="operator">rotated</span> 2<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> y<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"map the <span class="free">v</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Theorem 2›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> self_slicer <span class="quoted"><span class="quoted">"MFOTL.nfv <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"MFOTL.fv <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">σ</span> <span class="bound">v</span> <span class="bound">i</span><span class="main">.</span> MFOTL.sat <span class="bound">σ</span> <span class="bound">v</span> <span class="bound">i</span> <span class="free">φ</span>"</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted">splitter</span> <span class="quoted">joiner</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> mono_splitter<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> sound complete<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sound <span class="skolem">π</span> <span class="skolem">i</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ok <span class="free">φ</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> joint_monitor.wf_monitor<span class="main">[</span><span class="operator">OF</span> sound<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sound <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">(</span>splitter <span class="skolem">π</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">strategy</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> joiner_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹ok <span class="free">φ</span> <span class="skolem">v</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monitor_split<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>complete <span class="skolem">π</span> <span class="skolem">i</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ok <span class="free">φ</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf_monitor<span class="main">[</span><span class="operator">OF</span> complete<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> complete strategy_nonempty <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">strategy</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">(</span>splitter <span class="skolem">π</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> complete <span class="quoted"><span class="quoted">‹ok <span class="free">φ</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monitor_split<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> k <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> joiner_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Towards Theorem 3›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">names</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> MFOTL.formula <span class="main">⇒</span> MFOTL.name set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">names</span> <span class="main">(</span>MFOTL.Pred <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">names</span> <span class="main">(</span>MFOTL.Eq <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">names</span> <span class="main">(</span>MFOTL.Neg <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">names</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">names</span> <span class="main">(</span>MFOTL.Or <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">names</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">∪</span> <span class="free">names</span> <span class="free"><span class="bound"><span class="entity">β</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">names</span> <span class="main">(</span>MFOTL.Exists <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">names</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">names</span> <span class="main">(</span>MFOTL.Prev <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">names</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">names</span> <span class="main">(</span>MFOTL.Next <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">names</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">names</span> <span class="main">(</span>MFOTL.Since <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">names</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">∪</span> <span class="free">names</span> <span class="free"><span class="bound"><span class="entity">β</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">names</span> <span class="main">(</span>MFOTL.Until <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">names</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">∪</span> <span class="free">names</span> <span class="free"><span class="bound"><span class="entity">β</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">gen_unique</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> MFOTL.formula <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">gen_unique</span> <span class="main">(</span>MFOTL.Pred <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">gen_unique</span> <span class="main">(</span>MFOTL.Eq <span class="main">(</span>MFOTL.Var <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">(</span>MFOTL.Const <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">gen_unique</span> <span class="main">(</span>MFOTL.Eq <span class="main">(</span>MFOTL.Const <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">(</span>MFOTL.Var <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">gen_unique</span> <span class="main">(</span>MFOTL.Eq <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">gen_unique</span> <span class="main">(</span>MFOTL.Neg <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">gen_unique</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">gen_unique</span> <span class="main">(</span>MFOTL.Or <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">gen_unique</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">∧</span> <span class="free">gen_unique</span> <span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="main">∧</span> names <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">∩</span> names <span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">gen_unique</span> <span class="main">(</span>MFOTL.Exists <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">gen_unique</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">gen_unique</span> <span class="main">(</span>MFOTL.Prev <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">gen_unique</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">gen_unique</span> <span class="main">(</span>MFOTL.Next <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">gen_unique</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">gen_unique</span> <span class="main">(</span>MFOTL.Since <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">gen_unique</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">∧</span> <span class="free">gen_unique</span> <span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="main">∧</span> names <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">∩</span> names <span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">gen_unique</span> <span class="main">(</span>MFOTL.Until <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">gen_unique</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">∧</span> <span class="free">gen_unique</span> <span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="main">∧</span> names <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">∩</span> names <span class="free"><span class="bound"><span class="entity">β</span></span></span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sat_inter_names_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> names <span class="free">φ</span> <span class="main">⟹</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">e</span><span class="main">,</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">e</span><span class="main">,</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="free">F</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span>
  MFOTL.sat <span class="main">(</span>map_Γ <span class="main">(</span><span class="main">λ</span><span class="bound">D</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∩</span> <span class="free">E</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">v</span> <span class="free">i</span> <span class="free">φ</span> <span class="main">⟷</span> MFOTL.sat <span class="main">(</span>map_Γ <span class="main">(</span><span class="main">λ</span><span class="bound">D</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∩</span> <span class="free">F</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="free">v</span> <span class="free">i</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> matches_in_names<span class="main">:</span> <span class="quoted"><span class="quoted">"MFOTL.matches <span class="free">v</span> <span class="free">φ</span> <span class="free">x</span> <span class="main">⟹</span> fst <span class="free">x</span> <span class="main">∈</span> names <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> unique_names_matches_absorb<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="free">x</span> <span class="main">∈</span> names <span class="free">α</span> <span class="main">⟹</span> names <span class="free">α</span> <span class="main">∩</span> names <span class="free">β</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span>
    MFOTL.matches <span class="free">v</span> <span class="free">α</span> <span class="free">x</span> <span class="main">∨</span> MFOTL.matches <span class="free">v</span> <span class="free">β</span> <span class="free">x</span> <span class="main">⟷</span> MFOTL.matches <span class="free">v</span> <span class="free">α</span> <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"fst <span class="free">x</span> <span class="main">∈</span> names <span class="free">β</span> <span class="main">⟹</span> names <span class="free">α</span> <span class="main">∩</span> names <span class="free">β</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span>
    MFOTL.matches <span class="free">v</span> <span class="free">α</span> <span class="free">x</span> <span class="main">∨</span> MFOTL.matches <span class="free">v</span> <span class="free">β</span> <span class="free">x</span> <span class="main">⟷</span> MFOTL.matches <span class="free">v</span> <span class="free">β</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> matches_in_names<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mergeable_envs</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mergeable_envs</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v1</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">v2</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span> <span class="bound">f</span><span class="main">.</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="bound">v1</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">B</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="bound">v2</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">A</span> <span class="main">∪</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">v</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mergeable_envsI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v1</span> <span class="bound">v2</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="bound">v2</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> length <span class="bound">v</span> <span class="main">=</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> <span class="bound">v</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">v1</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">v2</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mergeable_envs <span class="free">n</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mergeable_envs_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> mergeable<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>mergeable <span class="skolem">v1</span> <span class="skolem">v2</span> <span class="skolem">A</span> <span class="skolem">B</span> <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tabulate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∪</span> <span class="skolem">B</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="skolem">v1</span> <span class="main">!</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v1</span></span> <span class="quoted"><span class="skolem">v2</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> in_listset_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> listset <span class="free">As</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">As</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">!</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">As</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">As</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_Cons_def nth_Cons <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.split<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> all_nth_in_listset<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">=</span> length <span class="free">As</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">As</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">As</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> listset <span class="free">As</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">As</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_Cons_def nth_Cons<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mergeable_envs_listset<span class="main">:</span> <span class="quoted"><span class="quoted">"mergeable_envs <span class="main">(</span>length <span class="free">As</span><span class="main">)</span> <span class="main">(</span>listset <span class="free">As</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mergeable_envsI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> all_nth_in_listset <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> in_listset_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mergeable_envs_Ex<span class="main">:</span> <span class="quoted"><span class="quoted">"mergeable_envs <span class="free">n</span> <span class="free">S</span> <span class="main">⟹</span> MFOTL.nfv <span class="free">α</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> MFOTL.nfv <span class="free">β</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fv <span class="free">α</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v</span> <span class="main">!</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fv <span class="free">β</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v</span> <span class="main">!</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fv <span class="free">α</span> <span class="main">∪</span> fv <span class="free">β</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v</span> <span class="main">!</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> mergeable<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>mergeable <span class="skolem">v1</span> <span class="skolem">v2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order.strict_trans2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fvi_less_nfv<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">rule_format</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mergeable_envs_def<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">v1</span></span> <span class="quoted"><span class="skolem">v2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> in_set_ConsE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> set_Cons <span class="free">A</span> <span class="free">As</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">y</span> <span class="bound">ys</span><span class="main">.</span> <span class="free">xs</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">#</span> <span class="bound">ys</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">ys</span> <span class="main">∈</span> <span class="free">As</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_Cons_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> mergeable_envs_set_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"mergeable_envs <span class="free">n</span> <span class="free">S</span> <span class="main">⟹</span> mergeable_envs <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span>set_Cons UNIV <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mergeable_envs_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> in_set_ConsE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> mergeable<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>mergeable <span class="skolem">v1</span> <span class="skolem">v2</span> <span class="skolem">A</span> <span class="skolem">B</span> <span class="skolem">f</span> <span class="skolem">y1</span> <span class="skolem">ys1</span> <span class="skolem">y2</span> <span class="skolem">ys2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> mergeable<span class="main">(</span>4-9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?A</span> <span class="main">∪</span> <span class="var">?B</span><span class="main">.</span> <span class="bound">v</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mergeable<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mergeable<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">ys1</span></span> <span class="quoted"><span class="skolem">ys2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?A</span> <span class="main">∪</span> <span class="var">?B</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span> <span class="main"><span class="main"><span class="main">#</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">v</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_Cons' set_Cons_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> slice_Exists<span class="main">:</span> <span class="quoted"><span class="quoted">"MFOTL_slicer.slice <span class="main">(</span>MFOTL.Exists <span class="free">φ</span><span class="main">)</span> <span class="free">S</span> <span class="free">σ</span> <span class="main">=</span> MFOTL_slicer.slice <span class="free">φ</span> <span class="main">(</span>set_Cons UNIV <span class="free">S</span><span class="main">)</span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_Cons_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> map_Γ_cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> image_Suc_fvi<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">`</span> MFOTL.fvi <span class="main">(</span>Suc <span class="free">b</span><span class="main">)</span> <span class="free">φ</span> <span class="main">=</span> MFOTL.fvi <span class="free">b</span> <span class="free">φ</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def Bex_def MFOTL.fvi_Suc <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> gr0_implies_Suc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nfv_Exists<span class="main">:</span> <span class="quoted"><span class="quoted">"MFOTL.nfv <span class="main">(</span>MFOTL.Exists <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> MFOTL.nfv <span class="free">φ</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> MFOTL.nfv_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"fv <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_Suc_fvi mono_Max_commute<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mono_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_Cons_empty_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set_Cons <span class="free">A</span> <span class="free">Xs</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="free">Xs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_Cons_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> unique_sat_slice_mem<span class="main">:</span> <span class="quoted"><span class="quoted">"safe_formula <span class="free">φ</span> <span class="main">⟹</span> gen_unique <span class="free">φ</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span>
  mergeable_envs <span class="free">n</span> <span class="free">S</span> <span class="main">⟹</span> MFOTL.nfv <span class="free">φ</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span>
  MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="free">φ</span> <span class="free">S</span> <span class="free">σ</span><span class="main">)</span> <span class="free">v</span> <span class="free">i</span> <span class="free">φ</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">v'</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fv <span class="free">φ</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v</span> <span class="main">!</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> safe_formula_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> MFOTL.is_Const_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> MFOTL.is_Const_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">e</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>set <span class="skolem">ts</span><span class="main">.</span> MFOTL.eval_trm <span class="skolem">v'</span> <span class="bound">t</span> <span class="main">=</span> MFOTL.eval_trm <span class="skolem">v</span> <span class="bound">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>set <span class="skolem">ts</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fv_trm <span class="bound">t</span><span class="main">.</span> <span class="skolem">v'</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">!</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> set <span class="skolem">ts</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"MFOTL.eval_trm <span class="skolem">v'</span> <span class="skolem">t</span> <span class="main">=</span> MFOTL.eval_trm <span class="skolem">v</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fv_trm <span class="skolem">t</span><span class="main">.</span> <span class="skolem">v'</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">!</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹gen_unique <span class="main">(</span>MFOTL.And <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="main">(</span>MFOTL.And <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">i</span> <span class="skolem">φ</span> <span class="main">=</span> MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="skolem">φ</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">i</span> <span class="skolem">φ</span>"</span></span>
    <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="main">(</span>MFOTL.And <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">i</span> <span class="skolem">ψ</span> <span class="main">=</span> MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="skolem">ψ</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">i</span> <span class="skolem">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> MFOTL.And_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unique_names_matches_absorb <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sat_inter_names_cong<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> 6<span class="main">(</span>1<span class="main">,</span>4-<span class="main">)</span> 6<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span><span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> S<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">S</span></span></span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> MFOTL.And_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mergeable_envs_Ex<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹gen_unique <span class="main">(</span>MFOTL.And_Not <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="main">(</span>MFOTL.And_Not <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">i</span> <span class="skolem">φ</span> <span class="main">=</span> MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="skolem">φ</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">i</span> <span class="skolem">φ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> MFOTL.And_Not_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unique_names_matches_absorb <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sat_inter_names_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 7<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>5-<span class="main">)</span> 7<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fv <span class="skolem">φ</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">!</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> MFOTL.And_Not_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹fv <span class="skolem">ψ</span> <span class="main">⊆</span> fv <span class="skolem">φ</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> MFOTL.fvi_And_Not<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹gen_unique <span class="main">(</span>MFOTL.Or <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="main">(</span>MFOTL.Or <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">i</span> <span class="skolem">φ</span> <span class="main">=</span> MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="skolem">φ</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">i</span> <span class="skolem">φ</span>"</span></span>
    <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="main">(</span>MFOTL.Or <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">i</span> <span class="skolem">ψ</span> <span class="main">=</span> MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="skolem">ψ</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">i</span> <span class="skolem">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unique_names_matches_absorb <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sat_inter_names_cong<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> 8<span class="main">(</span>1<span class="main">,</span>4-<span class="main">)</span> 8<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span><span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> S<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">S</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fv <span class="skolem">φ</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">!</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹fv <span class="skolem">ψ</span> <span class="main">=</span> fv <span class="skolem">φ</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹fv <span class="skolem">ψ</span> <span class="main">=</span> fv <span class="skolem">φ</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>9 <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> sat_φ<span class="main">:</span> <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="main">(</span>MFOTL.Exists <span class="skolem">φ</span><span class="main">)</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"9.prems"</span> sat_φ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">∈</span>set_Cons UNIV <span class="skolem">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fv <span class="skolem">φ</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">#</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">!</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> slice_Exists
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="quoted">"9.IH"</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nfv_Exists <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mergeable_envs_set_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_Cons_def fvi_Suc Ball_def nth_Cons <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>10 <span class="skolem">I</span> <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="skolem">φ</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">j</span> <span class="skolem">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 10 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>11 <span class="skolem">I</span> <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="skolem">φ</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">j</span> <span class="skolem">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 11 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>12 <span class="skolem">φ</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹gen_unique <span class="main">(</span>MFOTL.Since <span class="skolem">φ</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span>
    <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="main">(</span>MFOTL.Since <span class="skolem">φ</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">j</span> <span class="skolem">ψ</span> <span class="main">=</span> MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="skolem">ψ</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">j</span> <span class="skolem">ψ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unique_names_matches_absorb <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sat_inter_names_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 12 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="main">(</span>MFOTL.Since <span class="skolem">φ</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">j</span> <span class="skolem">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 12 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fv <span class="skolem">ψ</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">!</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹fv <span class="skolem">φ</span> <span class="main">⊆</span> fv <span class="skolem">ψ</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>13 <span class="skolem">φ</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹gen_unique <span class="main">(</span>MFOTL.Since <span class="main">(</span>MFOTL.Neg <span class="skolem">φ</span><span class="main">)</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span>
    <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="main">(</span>MFOTL.Since <span class="main">(</span>MFOTL.Neg <span class="skolem">φ</span><span class="main">)</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">j</span> <span class="skolem">ψ</span> <span class="main">=</span> MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="skolem">ψ</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">j</span> <span class="skolem">ψ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unique_names_matches_absorb <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sat_inter_names_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 13 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="main">(</span>MFOTL.Since <span class="main">(</span>MFOTL.Neg <span class="skolem">φ</span><span class="main">)</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">j</span> <span class="skolem">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 13 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fv <span class="skolem">ψ</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">!</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹fv <span class="main">(</span>MFOTL.Neg <span class="skolem">φ</span><span class="main">)</span> <span class="main">⊆</span> fv <span class="skolem">ψ</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>14 <span class="skolem">φ</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹gen_unique <span class="main">(</span>MFOTL.Until <span class="skolem">φ</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span>
    <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="main">(</span>MFOTL.Until <span class="skolem">φ</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">j</span> <span class="skolem">ψ</span> <span class="main">=</span> MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="skolem">ψ</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">j</span> <span class="skolem">ψ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unique_names_matches_absorb <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sat_inter_names_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 14 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="main">(</span>MFOTL.Until <span class="skolem">φ</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">j</span> <span class="skolem">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 14 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fv <span class="skolem">ψ</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">!</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹fv <span class="skolem">φ</span> <span class="main">⊆</span> fv <span class="skolem">ψ</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>15 <span class="skolem">φ</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹gen_unique <span class="main">(</span>MFOTL.Until <span class="main">(</span>MFOTL.Neg <span class="skolem">φ</span><span class="main">)</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span>
    <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="main">(</span>MFOTL.Until <span class="main">(</span>MFOTL.Neg <span class="skolem">φ</span><span class="main">)</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">j</span> <span class="skolem">ψ</span> <span class="main">=</span> MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="skolem">ψ</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">j</span> <span class="skolem">ψ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unique_names_matches_absorb <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sat_inter_names_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 15 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="main">(</span>MFOTL.Until <span class="main">(</span>MFOTL.Neg <span class="skolem">φ</span><span class="main">)</span> <span class="skolem">I</span> <span class="skolem">ψ</span><span class="main">)</span> <span class="skolem">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">j</span> <span class="skolem">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 15 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fv <span class="skolem">ψ</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">!</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹fv <span class="main">(</span>MFOTL.Neg <span class="skolem">φ</span><span class="main">)</span> <span class="main">⊆</span> fv <span class="skolem">ψ</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unique_sat_slice<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> formula<span class="main">:</span> <span class="quoted"><span class="quoted">"safe_formula <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"gen_unique <span class="free">φ</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> restr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"mergeable_envs <span class="main">(</span>MFOTL.nfv <span class="free">φ</span><span class="main">)</span> <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sat_slice<span class="main">:</span> <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="free">φ</span> <span class="free">S</span> <span class="free">σ</span><span class="main">)</span> <span class="free">v</span> <span class="free">i</span> <span class="free">φ</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"MFOTL.sat <span class="free">σ</span> <span class="free">v</span> <span class="free">i</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fv_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fv <span class="free">φ</span><span class="main">.</span> <span class="skolem">v'</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">v</span> <span class="main">!</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unique_sat_slice_mem<span class="main">[</span><span class="operator">OF</span> formula restr order_refl sat_slice<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> sat_slice <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="free">φ</span> <span class="free">S</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">v'</span> <span class="free">i</span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">iff</span><span class="main"><span class="main">:</span></span> sat_fvi_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"MFOTL.sat <span class="free">σ</span> <span class="skolem">v'</span> <span class="free">i</span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sat_slice_iff<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">∈</span> <span class="free">S</span>›</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> fv_eq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">iff</span><span class="main"><span class="main">:</span></span> sat_fvi_cong<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Lemma 3›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> splitting_strategy<span class="main">)</span> unique_sat_strategy<span class="main">:</span>
  <span class="quoted"><span class="quoted">"safe_formula <span class="free">φ</span> <span class="main">⟹</span> gen_unique <span class="free">φ</span> <span class="main">⟹</span> slice_set <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span>
  mergeable_envs <span class="main">(</span>MFOTL.nfv <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>slice_set <span class="free">k</span><span class="main">)</span> <span class="main">⟹</span>
  MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="free">φ</span> <span class="main">(</span>slice_set <span class="free">k</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>map the <span class="free">v</span><span class="main">)</span> <span class="free">i</span> <span class="free">φ</span> <span class="main">⟹</span>
  ok <span class="free">φ</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">∈</span> <span class="free">strategy</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> <span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> unique_sat_slice_mem<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> wf_tuple_cong<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> skip_inter <span class="main">=</span> joint_data_slicer <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"slice_set <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> mergeable<span class="main">:</span> <span class="quoted"><span class="quoted">"mergeable_envs <span class="main">(</span>MFOTL.nfv <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>slice_set <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of J'›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">skip_joiner</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">k</span><span class="main">.</span> <span class="bound">s</span> <span class="bound">k</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Theorem 3›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> skip_joiner<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"safe_formula <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"gen_unique <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"joiner <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">M</span> <span class="main">(</span>splitter <span class="free">π</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> skip_joiner <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">M</span> <span class="main">(</span>splitter <span class="free">π</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> in_M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">(</span>splitter <span class="free">π</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> skip_joiner_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> ex_prefix_of <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prefix_of <span class="free">π</span> <span class="skolem">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> wf_monitor<span class="main">[</span><span class="operator">OF</span> in_M<span class="main">]</span> sound_monitor<span class="main">[</span><span class="operator">OF</span> in_M<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"MFOTL.sat <span class="main">(</span>MFOTL_slicer.slice <span class="free">φ</span> <span class="main">(</span>slice_set <span class="skolem">k</span><span class="main">)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>map the <span class="skolem">v</span><span class="main">)</span> <span class="skolem">i</span> <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"ok <span class="free">φ</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> splitter_pslice <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prefix_of_pmap_Γ<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> unique_sat_strategy<span class="main">[</span><span class="operator">OF</span> assms nonempty mergeable this<span class="main">]</span>
  <span class="keyword1"><span class="command">with</span></span> in_M <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> joiner_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> joiner_def skip_joiner_def<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> skip_joint_monitor<span class="main">:</span> MFOTL_monitor <span class="quoted"><span class="free">φ</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">π</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> safe_formula <span class="free">φ</span> <span class="main">∧</span> gen_unique <span class="free">φ</span> <span class="keyword1">then</span> skip_joiner <span class="keyword1">else</span> joiner<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">M</span> <span class="main">(</span>splitter <span class="bound">π</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> joint_monitor.mono_monitor joint_monitor.wf_monitor joint_monitor.sound_monitor joint_monitor.complete_monitor
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> skip_joiner<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</body>

</html>